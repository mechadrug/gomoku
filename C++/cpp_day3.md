# 栈在函数调用中的作用

1. 程序实体在内存中的安排（四个区域）

    - 静态数据区：存放全局变量，static存储类的局部变量以及常量的内存分配。默认初始化是 0.

    - 代码区：程序指令，所有函数代码（c++）

    - 栈区：用于自动存储类的局部变量，函数形参，函数调用有关信息**栈区被各个函数共享，节省空间**

    - 堆区：动态变量内存分配

2. 栈区的分配图形化解释：（局部变量和函数的栈空间都会销毁）

    参考ppt：1-2-2

3. 函数返回值的存储：

    - 返回值类型为基本类型（int，float，double...）：编译器将返回值存储在cpu寄存器中（高效处理）

    - 返回值类型为指针或引用：将**指针的地址**存储在寄存器中而不是被指向变量的值

    - 返回值优化（RVO）：编译器在返回对象（对象或结构体）时，将对象的内存空间提前分配在调用者的栈上**编译器通常会在调用者的栈帧中分配存储空间，直接在该位置构造返回的对象。**

    - 返回值为引用(特别是类成员):引用没有拷贝，函数会返回该变量的内存地址。

    - 返回值类型为void:编译器忽略处理返回值

    - 可移动对象的返回：右值引用(&&) 编译器会优化存储和移动此对象

4. 递归函数执行中栈的使用情况：

    - 递归函数≈同名函数多个实例。每次调用都将产生新的局部变量，拥有不同的**栈空间**

    - 栈空间大小：限制函数调用的**深度**（error：stack overflow）
    - 其他注意事项：不要把过大的结构体按值传给函数，也尽量不要在函数中定义很大的局部数组变量。产生的拷贝过大会影响内存占用，并导致程序性能下降。对于只读操作使用const，对于需要修改的数据可以使用普通引用和右值引用。